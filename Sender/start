#!/bin/bash
set -euo pipefail

SCRIPT_DIR="$(dirname "$(readlink -f "$0")")"
cd "$SCRIPT_DIR"

SENDER="./bin/sender"

# Find and kill existing sender processes
PIDS=$(pgrep -x "sender" || true)
if [ -n "$PIDS" ]; then
  echo "Killing PIDs: $PIDS"
  echo "$PIDS" | xargs kill -9
fi

# Start sender on CPU 1 in background
nohup taskset -c 1 "$SENDER" >/dev/null 2>&1 &
disown
